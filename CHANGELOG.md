# Лог изменений

Все заметные изменения в этом проекте будут отражаться в этом документе.

Формат лога изменений базируется на [Keep a Changelog](https://keepachangelog.com/en/1.0.0/).

## [2.11.28] - 2023-02-01

### Изменено

* обновлены зависимости `MyLab.ApiClient.Test` (1.3.6 -> 1.5.6) и `MyLab.Log`(3.2.10 -> 3.5.21)

## [2.11.26] - 2023-01-14

### Добавлено

* завершение объекта потребителя после обработки сообщения, если он реализует `IDisposable` или `IAsyncDisposable` 

## [2.11.25] - 2022-11-25

### Исправлено

* ошибка отсутствия логгера при создании канала

## [2.11.24] - 2022-11-18

### Добавлено

* регистрация объекта потребителя с получением имени очереди из опций

## [2.10.24] - 2022-11-17

### Исправлено

* попытки подключения к `RabbitMQ` в режиме эмуляции
* метод `IntoDefault` при конструкции публикуемого сообщения игнорировал переданный `routingKey`

## [2.9.22] - 2022-09-06

### Добавлено

* диагностика ошибок в случае, когда проблемы с созданием подключений и каналов

## [2.9.21] - 2022-07-08

### Исправлено

* баг с нулевым логгером в поставщике каналов

## [2.9.20] - 2022-05-31

### Добавлено

* повторные попытки подключения потребителя при неудачах до первого успеха
* лучшее логирование неудачной попытки создать канал

## [2.9.16] - 2022-05-31

### Добавлено

* возможность в объектной модели очищать очередь 

### Исправлено

* баг при отправке сообщения в методе `Into<Tmodel>(routingKey)` - терялся указанный `routingKey`

### Изменено 

* имена методов установки содержимого при отправке сообщения, которые вызывали проблемы из-за своего названия, которое говорит о факте отправки: `SendJson` -> `SetJsonContent`, `SendString` -> `SetStringContent`, `SendBinary` -> `SetBinaryContent`

## [2.8.15] - 2022-04-20

### Исправлено

* проблемы синхронного вызова асинхронного потребителя в режиме эмуляции
* баг с неправильной регистрацией сервисов потребления сообщений 

## [2.8.13] - 2022-04-15

### Добавлено

* режим эмуляции

## [2.7.13] - 2022-02-15

### Изменено

* контекст потребления теперь возвращает `IConsumingContextInstance` вместо `IDisposable`

## [2.6.13] - 2021-12-03

### Изменено

* обновлены зависимости, связанные с логированием
* `LazyRabbitConnectionProvider` стал публичным для возможности применения в тестах

## [2.5.13] - 2021-11-11

### Изменено

* обработка исключения обработки полученного сообщения в контексте потребления

## [2.5.12] - 2021-11-02 

### Изменено

* обработчики потребляемых сообщений теперь имеют время жизни `scope` 
* обработчики отправляемых сообщений заменены на контекст публикации 
* обработчики получаемых сообщений заменены на контекст потребления
* поддержка `null` в качестве неустановленных контекстов потребления и отправки

### Обновлено

* `MyLab.Log.Dsl` до версии с инъекцией 

## [2.4.9] - 2021-10-19 

### Добавлено

* поддержка  внедрения в подготовку отправляемых сообщений
* поддержка внедрения в обработку полученных сообщений

## [2.3.9] - 2021-09-21

### Исправлено 

* использование подключения для потрбебления из общего провайдера
* `PrefetchCount` при потреблении = 1
* поставщик каналов использует поставщика подключений по необходимости

## [2.3.8] - 2021-09-16

### Добавлено

* опциональность регистрации потребителя с использованием конфигурации в методе расширения для коллекции сервисов 

## [2.2.8] - 2021-09-16

### Добавлено

* опциональная регистрация потребителя для опциональных параметров конфигурации 
* поддержка фонового подключения
* поддержка `health-check`

### Изменено

* для добавления сервисов подключения к `Rabbit` и сервиса `IRabbitPublisher` достаточно использовать метод расширения для коллекции сервисов `AddRabbit`

## [2.1.5] - 2021-09-07

### Исправлено

* обработка входящих сообщений по одному

## [2.1.4] - 2021-09-01

### Изменено

* не происходит подключение для потребления, если не зарегистрировано ни одного потребителя 

## [2.1.3] - 2021-08-29

### Добавлено

* из коробки регистратор с использованием опций `OptionsConsumerRegistrar<TOptions, TConsumer>`
* для интеграции метод добавления потребителя, позволяющий использовать опции для получения имени очереди 
* регистраторы из коробки стали публичными: `SingleConsumerRegistrar`, `TypedConsumerRegistrar<TConsumer>`

## [2.0.1] - 2021-08-27

### Добавлено

* мультиплатформенность: `netcoreapp3.1`, `net5.0` 

## [2.0.0] - 2021-08-23

### Изменено

* наименование проекта `MyLab.Mq` -> `MyLAb.RabbitClient`
* полный рефакторинг с целью оптимизации

## [1.9.26] - 2021-08-05

### Добавлено

* опциональное потребление - возможность отключения функции потребления, если не указана конфигурация
* более подробное логирование запуска/останова потребления 
* логирование получения сообщений
* логирование ошибок сериализации `json` сообщения с приведением дампа сообщения в логе 
* поддержка получения строки содержания сообщения, не смотря на то, что там может быть `json`-сериализованный объект - не строка

### Исправлено

* рефакторинг `MqQueueFactory`  для удобства использования в тестах
* публикация класса `DefaultMqChannelRrovider` для удобства использования в тестах

## [1.8.19] - 2021-07-06

### Исправлено

* проблемы с запуском потока мониторинга таймаута обработки пачки сообщений 

## [1.8.15] - 2021-07-05

### Добавлено

* указание таймаута набора пачки сообщений для обработки пачкой

## [1.7.15] - 2021-06-22

### Исправлено

* Обновлена зависимость от `MyLab.Log.Dsl`

## [1.7.14] - 2021-02-25

### Исправлено:

* Не удалялся сервис подключения к `RabbitMQ` при добавлении эмулятора сообщений

## [1.7.13] - 2021-02-08

### Изменено:

* Переход на `MyLab.StatusProvider v1.5.9`

## [1.7.12] - 2020-11-25

### Исправлено:

* правильная поддержка `PrefetchCount`
* сериализация содержания исходящих сообщений с исключением полей со значением `null`. 

## [1.7.9] - 2020-11-11

### Добавлено:

* Возможность регистрировать потребителей очередей во время выполнения приложения
* Отдельный метод интеграции для регистрации Эмулятора сообщений
* Регистрация фабричных делегатов потребителей
* Возможность указания `dead-letter-exchange` и `dead-letter-routing-key` для очереди
* Возможность регистрации потребителя только в случае указания определённой опции конфигурации

### Удалено:

* Добавление регистратора обработчика входящих сообщений при интеграции в приложение

## [1.6.4] - 2020-10-05

### Исправлено:

* Исключается менеджер потребления, который подключается к RabbitMQ, в случае использования эмулятора

## [1.6.3] - 2020-07-07

### Добавлено:

* Эмулятор входящих сообщений
* Раздел тестирования в [readme](./README.md#Функциональное-тестирование)

## [1.5.3] - 2020-07-06

### Добавлено:

* Поле `RequeueWhenError` у потребителя. Для указания поведения переотправки сообщения в исходную очередь при ошибке его обработки.  `false` по умолчанию.

## [1.4.3] - 2020-06-01

### Исправлено

* NullReferenceException, когда при публикации сообщения не указывается явно цель.

## [1.4.2] - 2020-05-18

### Исправлено

* добавление недостающего поставщика подключения при интеграции механизма публикации.

## [1.4.1] - 2020-05-12

### Исправлено

* рекурсия при публикации сообщения через метод расширения интерфейса `IMqPublisher`

## [1.4.0] - 2020-04-30

### Добавлено

* Добавлен журнал изменений;
* [readme](./README.md)
* Упрощённые методы расширения для отправки сообщений.
